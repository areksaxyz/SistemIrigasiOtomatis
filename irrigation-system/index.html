<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistem Irigasi Otomatis - Desktop (Simulasi Real-time)</title>
<script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
<script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>

<style>
    /* Gaya layout desktop global */
    body {
        background-color: #1a202c;
        display: flex;
        min-height: 100vh;
        margin: 0;
        font-family: Arial, sans-serif;
    }

    #root {
        display: flex;
        flex-grow: 1;
    }

    /* Gaya Sidebar */
    .sidebar {
        width: 256px; /* w-64 */
        background-color: #0b2e13; /* green-900 */
        color: white;
        padding: 1rem; /* p-4 */
        flex-shrink: 0;
    }
    .sidebar ul li {
        margin-bottom: 1rem; /* mb-4 */
    }
    .sidebar button {
        display: flex;
        align-items: center;
        width: 100%;
        text-align: left;
        padding: 0.5rem; /* p-2 */
        border-radius: 0.25rem; /* rounded */
        transition: background-color 0.2s;
    }
    .sidebar button:hover {
        background-color: #10411b; /* green-800 */
    }
    .sidebar button.active {
        background-color: #16a34a; /* green-700 */
    }
    .sidebar svg {
        width: 24px; /* w-6 */
        height: 24px; /* h-6 */
        margin-right: 0.5rem; /* mr-2 */
    }

    /* Area konten utama */
    .main-content {
        flex-grow: 1;
        padding: 2rem; /* p-8 */
        background-color: white;
        overflow-y: auto;
        position: relative;
    }

    /* Header untuk halaman */
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem; /* mb-6 */
        color: #10411b; /* text-green-800 */
    }
    .page-header h1 {
        font-size: 2.25rem; /* text-3xl */
        font-weight: bold;
    }
    .page-header .icon-buttons {
        display: flex;
        gap: 1rem; /* Spasi antar ikon */
    }
    .page-header button {
        color: #10411b; /* text-green-800 */
        transition: color 0.2s;
    }
    .page-header button:hover {
        color: #10b981; /* green-600 */
    }
    .page-header .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background-color: #ef4444; /* Red-500 */
        color: white;
        border-radius: 50%;
        font-size: 0.75rem;
        width: 18px;
        height: 18px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
    }

    /* Gaya khusus halaman Beranda */
    .dashboard-card {
        background-color: #f3f4f6; /* gray-100 */
        padding: 1.5rem; /* p-6 */
        border-radius: 0.5rem; /* rounded-lg */
        text-align: center;
    }
    .dashboard-card p {
        color: #4b5563; /* gray-600 */
    }
    .dashboard-card .value {
        font-size: 2.25rem; /* text-4xl */
        font-weight: bold;
        color: #10411b; /* green-800 */
        margin-top: 0.5rem; /* mt-2 */
    }
    .dashboard-card .moisture-indicator {
        font-size: 1rem;
        font-weight: 600;
        margin-top: 0.25rem;
    }
    .dashboard-card .moisture-indicator.sangat-kering { color: #dc2626; } /* red-600 */
    .dashboard-card .moisture-indicator.kering { color: #f59e0b; } /* yellow-500 */
    .dashboard-card .moisture-indicator.sedikit-basah { color: #10b981; } /* green-500 */
    .dashboard-card .moisture-indicator.basah { color: #1d4ed8; } /* blue-700 */

    /* Ikon Cuaca */
    .weather-icon {
        width: 32px;
        height: 32px;
        margin: 0 auto 0.5rem;
        color: #f59e0b; /* default to yellow for sunny */
    }
    .weather-icon.hujan { color: #3b82f6; } /* blue-500 */
    .weather-icon.berawan { color: #9ca3af; } /* gray-400 */

    /* Indikator irigasi aktif di kartu */
    .irrigation-active-indicator {
        display: inline-block;
        width: 16px;
        height: 16px;
        background-color: #38a169; /* green-600 */
        border-radius: 50%;
        margin-left: 8px;
        animation: pulse 1.5s infinite ease-in-out;
    }

    @keyframes pulse {
        0% { transform: scale(0.8); opacity: 0.7; }
        50% { transform: scale(1.1); opacity: 1; }
        100% { transform: scale(0.8); opacity: 0.7; }
    }


    /* Gaya khusus grafik (untuk Beranda & Monitoring) */
    .chart-container {
        width: 100%;
        height: 150px;
        position: relative;
        overflow: hidden;
    }
    .chart-line {
        fill: none;
        stroke: #10b981;
        stroke-width: 2;
        transition: transform 0.5s linear;
    }
    .chart-dot {
        fill: #10b981;
        stroke: #fff;
        stroke-width: 1;
        transition: transform 0.5s linear;
    }
    .chart-threshold { stroke: #d4af37; stroke-width: 1; }

    /* Monitoring Page specific styles */
    .soil-moisture-chart-container {
        width: 100%;
        height: 200px;
        position: relative;
        overflow: hidden;
    }
    .soil-moisture-chart-line { fill: none; stroke: #22c55e; stroke-width: 2; transition: transform 0.5s linear; }
    .soil-moisture-dot { fill: #22c55e; stroke: #fff; stroke-width: 1; transition: transform 0.5s linear; }
    .threshold-line { stroke: #9ca3af; stroke-dasharray: 4 4; stroke-width: 1; }
    .aniltong-text {
        font-size: 0.875rem; color: #4b5563; position: absolute;
        transform: rotate(-90deg); transform-origin: 0 0;
        top: 80px; left: 50%; white-space: nowrap;
    }
    .sawah-status-card {
        background-color: #d1fae5;
        padding: 1rem;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
    }
    .sawah-status-card .icon-circle {
        width: 48px; height: 48px; background-color: white;
        border-radius: 50%; display: flex; justify-content: center;
        align-items: center; margin-right: 0.75rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .sawah-status-card .icon-circle svg {
        width: 28px; height: 28px; color: #065f46;
    }
    .sawah-status-card h3 {
        font-size: 1.125rem;
        font-weight: 600;
        color: #10411b;
    }
    .sawah-status-card p {
        font-size: 0.875rem;
    }
    .sawah-status-card .status-text.active { color: #16a34a; }
    .sawah-status-card .status-text.inactive { color: #dc2626; }


    /* History page specific styles */
    .history-section-date {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 1rem;
    }
    .history-card {
        background-color: #f3f4f6;
        padding: 1rem;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
    }
    .history-card .icon {
        width: 40px;
        height: 40px;
        margin-right: 1rem;
        flex-shrink: 0;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .history-card .icon svg {
        width: 28px; height: 28px; color: #065f46;
    }
    .history-card .details { flex-grow: 1; }
    .history-card .title {
        font-size: 1.125rem;
        font-weight: 600;
        color: #10411b;
    }
    .history-card .status {
        font-size: 0.875rem;
        font-weight: 500;
    }
    .history-card .moisture {
        font-size: 0.875rem;
        color: #4b5563;
    }
    .history-card .time {
        font-weight: 600;
        color: #4b5563;
        font-size: 0.875rem;
        margin-left: auto;
    }

    /* Notification Page specific styles */
    .notification-card {
        background-color: #f3f4f6;
        padding: 1.5rem;
        border-radius: 0.5rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: flex-start;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .notification-card .icon-circle {
        width: 60px; height: 60px;
        margin-right: 1.5rem;
        flex-shrink: 0;
        display: flex; justify-content: center; align-items: center;
        background-color: white;
        border-radius: 50%;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .notification-card .icon-circle svg {
        width: 32px; height: 32px;
    }
    .notification-card .content {
        flex-grow: 1;
    }
    .notification-card .title {
        font-weight: bold;
        color: #1f2937;
        font-size: 1.125rem;
        margin-bottom: 0.5rem;
        white-space: pre-line;
    }
    .notification-card .description {
        font-size: 1rem;
        color: #4b5563;
        margin-bottom: 0.75rem;
        white-space: pre-line;
    }
    .notification-card .meta {
        font-size: 0.875rem;
        color: #6b7280;
    }
    .notification-card .time {
        margin-left: auto;
        font-size: 0.875rem;
        color: #6b7280;
        flex-shrink: 0;
        text-align: right;
    }
    .notification-card.read {
        opacity: 0.7;
        background-color: #e5e7eb; /* gray-200 */
    }
    .notification-card button.read-button {
        margin-top: 0.5rem;
        background-color: #a7f3d0; /* green-200 */
        color: #047857; /* green-800 */
        padding: 0.25rem 0.75rem;
        border-radius: 0.25rem;
        font-size: 0.875rem;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    .notification-card button.read-button:hover {
        background-color: #6ee7b7; /* green-300 */
    }

    /* Settings Page Specific Styles */
    .settings-section-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 1rem;
        margin-top: 1.5rem;
    }
    .settings-item {
        background-color: #f3f4f6;
        padding: 1rem 1.5rem;
        border-radius: 0.5rem;
        margin-bottom: 0.75rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .settings-item .label {
        font-size: 1.125rem;
        color: #1f2937;
        flex-grow: 1;
    }
    .settings-item .value {
        font-size: 1.125rem;
        color: #4b5563;
        display: flex;
        align-items: center;
    }
    .settings-item .value svg {
        width: 20px; height: 20px;
        margin-left: 0.5rem;
        color: #9ca3af;
    }
    .settings-item .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 28px;
    }
    .settings-item .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    .settings-item .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 34px;
    }
    .settings-item .toggle-slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }
    .settings-item input:checked + .toggle-slider {
        background-color: #16a34a;
    }
    .settings-item input:checked + .toggle-slider:before {
        transform: translateX(22px);
    }
    .settings-item input[type="number"] {
        width: 80px;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        border: 1px solid #d1d5db;
        text-align: right;
        font-size: 1rem;
        color: #1f2937;
    }
    .settings-item select {
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        border: 1px solid #d1d5db;
        font-size: 1rem;
        color: #1f2937;
        background-color: white;
    }

    /* Gaya untuk notifikasi pop-up di layar */
    .screen-notification {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #38a169; /* green-600 */
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 0.5rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        min-width: 300px;
        text-align: center;
    }
    .screen-notification.show {
        opacity: 1;
        transform: translate(-50%, 0);
    }
    .screen-notification.error {
        background-color: #ef4444; /* red-500 */
    }
    .screen-notification.confirm {
        background-color: #f59e0b; /* orange-500 for warning/confirm */
        padding-bottom: 0.5rem; /* give space for buttons */
    }
    .screen-notification.confirm .buttons {
        margin-top: 1rem;
        display: flex;
        justify-content: center;
        gap: 1rem;
    }
    .screen-notification.confirm .buttons button {
        background-color: white;
        color: #1f2937;
        padding: 0.5rem 1rem;
        border-radius: 0.25rem;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    .screen-notification.confirm .buttons button.yes {
        background-color: #16a34a; /* green-600 */
        color: white;
    }
    .screen-notification.confirm .buttons button.no {
        background-color: #ef4444; /* red-500 */
        color: white;
    }


    /* Gaya untuk visualisasi sawah */
    .sawah-visual {
        width: 100%;
        height: 180px; /* Tinggi sawah */
        background-color: #b9f2ac; /* Light green for dry soil */
        border-radius: 8px;
        position: relative;
        overflow: hidden;
        margin-bottom: 1rem;
        border: 1px solid #6b7280; /* gray-500 */
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        color: #374151; /* gray-700 */
        font-size: 1.25rem;
    }

    .sawah-visual.kering { background-color: #fce8ad; } /* Light yellow for dry */
    .sawah-visual.sangat-kering { background-color: #fcdbd8; } /* Light red for very dry */
    .sawah-visual.sedikit-basah { background-color: #a7f3d0; } /* Light green for moist */
    .sawah-visual.basah { background-color: #93c5fd; } /* Light blue for wet */

    .sawah-water-level {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: #2563eb; /* blue-700 */
        transition: height 0.5s ease-out;
        opacity: 0.8;
    }

    .sawah-water-droplet {
        position: absolute;
        top: 10px;
        animation: drop 1s infinite linear;
        opacity: 0;
        color: #3b82f6;
    }
    .sawah-water-droplet svg { width: 24px; height: 24px; }

    @keyframes drop {
        0% { transform: translateY(-20px); opacity: 0; }
        20% { opacity: 1; }
        80% { transform: translateY(160px); opacity: 0; }
        100% { opacity: 0; }
    }

    .sawah-water-droplet:nth-child(1) { animation-delay: 0s; left: 20%; }
    .sawah-water-droplet:nth-child(2) { animation-delay: 0.3s; left: 50%; }
    .sawah-water-droplet:nth-child(3) { animation-delay: 0.6s; left: 80%; }


</style>
</head>
<body class="bg-green-800 flex min-h-screen">
<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // --- Helpers (Fungsi Pembantu) ---
    const getFormattedTime = () => {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        return `${hours}:${minutes}`;
    };

    const getFormattedDate = (date) => {
        const options = { day: 'numeric', month: 'long', year: 'numeric' };
        return date.toLocaleDateString('id-ID', options);
    };

    // Fungsi untuk memuat state dari localStorage
    const loadState = (key, defaultValue) => {
        try {
            const serializedState = localStorage.getItem(key);
            if (serializedState === null) {
                console.log(`[LoadState] ${key} not found in localStorage. Using default value.`, defaultValue);
                return defaultValue;
            }
            const parsedState = JSON.parse(serializedState);
            console.log(`[LoadState] Loaded ${key}:`, parsedState);
            return parsedState;
        } catch (error) {
            console.error(`[LoadState] Error loading state from localStorage for ${key}:`, error);
            return defaultValue;
        }
    };

    // Fungsi untuk menyimpan state ke localStorage
    const saveState = (key, state) => {
        try {
            const serializedState = JSON.stringify(state);
            localStorage.setItem(key, serializedState);
        } catch (error) {
            console.error(`[SaveState] Error saving state to localStorage for ${key}:`, error);
        }
    };

    // --- Komponen Header Halaman ---
    const PageHeader = ({ title, showNotificationIcon = false, notificationCount = 0, onNotificationClick }) => {
        return (
            <div className="page-header">
                <h1 className="text-3xl font-bold">{title}</h1>
                <div className="icon-buttons">
                    {showNotificationIcon && (
                        <div className="relative">
                            <button onClick={onNotificationClick}>
                                <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6V9c0-3.07-1.63-5.64-4.5-6.32V2.5c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.18C7.63 3.36 6 5.93 6 9v7l-2 2v1h16v-1l-2-2zm-2 1H8V9c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v8z"/>
                                </svg>
                            </button>
                            {notificationCount > 0 && (
                                <span className="notification-badge">{notificationCount}</span>
                            )}
                        </div>
                    )}
                </div>
            </div>
        );
    };

    // --- Komponen Notifikasi Layar ---
    const ScreenNotification = ({ message, type, isVisible, onClose, onConfirm }) => {
        const notificationClasses = `screen-notification ${isVisible ? 'show' : ''} ${type === 'error' ? 'error' : ''} ${type === 'confirm' ? 'confirm' : ''}`;
        
        useEffect(() => {
            if (isVisible && type !== 'confirm') { // Auto-hide for non-confirm notifications
                const timer = setTimeout(() => {
                    onClose();
                }, 4000); 
                return () => clearTimeout(timer);
            }
        }, [isVisible, onClose, type]);

        const handleYes = () => {
            if (onConfirm) onConfirm(true);
            onClose(); // Tutup notifikasi setelah konfirmasi
        };

        const handleNo = () => {
            // Pass false to indicate cancellation when 'Tidak' is clicked
            if (onConfirm) onConfirm(false); 
            onClose(); // Tutup notifikasi setelah konfirmasi
        };

        return (
            <div className={notificationClasses}>
                {message}
                {type === 'confirm' && (
                    <div className="buttons">
                        <button className="yes" onClick={handleYes}>Ya</button>
                        <button className="no" onClick={handleNo}>Tidak</button>
                    </div>
                )}
            </div>
        );
    };

    // --- Fungsi Pembantu Ikon Cuaca ---
    const getWeatherIcon = (condition) => {
        switch (condition.toLowerCase()) {
            case 'cerah':
                return <svg className="weather-icon" fill="currentColor" viewBox="0 0 24 24" ><path d="M12 2.5a.5.5 0 01.5.5v1a.5.5 0 01-1 0V3a.5.5 0 01.5-.5zM12 20.5a.5.5 0 01.5.5v1a.5.5 0 01-1 0v-1a.5.5 0 01.5-.5zM3.684 4.316a.5.5 0 01.707-.707l.707.707a.5.5 0 01-.707.707l-.707-.707zM19.609 20.316a.5.5 0 01.707-.707l.707.707a.5.5 0 01-.707.707l-.707-.707zM2.5 12a.5.5 0 01.5-.5h1a.5.5 0 010 1H3a.5.5 0 01-.5-.5zM19.5 12a.5.5 0 01.5-.5h1a.5.5 0 010 1h-1a.5.5 0 01-.5-.5zM4.316 20.316a.5.5 0 01-.707-.707l-.707-.707a.5.5 0 01.707-.707l.707.707zM20.316 4.316a.5.5 0 01-.707.707l-.707-.707a.5.5 0 01.707-.707l.707.707zM12 7a5 5 0 100 10 5 5 0 000-10z" /></svg>;
            case 'berawan':
                return <svg className="weather-icon berawan" fill="currentColor" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4c-3.72 0-6.84 2.73-7.48 6.35C1.84 10.74 0 13.01 0 15.5 0 18.57 2.43 21 5.5 21h13c3.07 0 5.5-2.43 5.5-5.5 0-2.61-1.95-4.82-4.65-5.46zM19 19H5.5c-2.21 0-4-1.79-4-4s1.79-4 4-4h.34C6.54 8.78 8.01 7 9.87 7c1.47 0 2.76.92 3.32 2.24l.08.19.19.06c2.01.59 3.44 2.45 3.44 4.61 0 2.21-1.79 4-4 4H19c2.21 0 4-1.79 4-4s-1.79-4-4-4z"/></svg>;
            case 'hujan':
                return <svg className="weather-icon hujan" fill="currentColor" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4c-3.72 0-6.84 2.73-7.48 6.35C1.84 10.74 0 13.01 0 15.5 0 18.57 2.43 21 5.5 21h13c3.07 0 5.5-2.43 5.5-5.5 0-2.61-1.95-4.82-4.65-5.46zM17 14.5c-.82 0-1.5-.68-1.5-1.5 0-.82.68-1.5 1.5-1.5s1.5.68 1.5 1.5-.68 1.5-1.5 1.5zM7 14.5c-.82 0-1.5-.68-1.5-1.5 0-.82.68-1.5 1.5-1.5s1.5.68 1.5 1.5-.68 1.5-1.5 1.5zM12 14.5c-.82 0-1.5-.68-1.5-1.5 0-.82.68-1.5 1.5-1.5s1.5.68 1.5 1.5-.68 1.5-1.5 1.5z"/></svg>;
            default:
                return <svg className="weather-icon" fill="currentColor" viewBox="0 0 24 24" ><path d="M12 2.5a.5.5 0 01.5.5v1a.5.5 0 01-1 0V3a.5.5 0 01.5-.5zM12 20.5a.5.5 0 01.5.5v1a.5.5 0 01-1 0v-1a.5.5 0 01.5-.5zM3.684 4.316a.5.5 0 01.707-.707l.707.707a.5.5 0 01-.707.707l-.707-.707zM19.609 20.316a.5.5 0 01.707-.707l.707.707a.5.5 0 01-.707.707l-.707-.707zM2.5 12a.5.5 0 01.5-.5h1a.5.5 0 010 1H3a.5.5 0 01-.5-.5zM19.5 12a.5.5 0 01.5-.5h1a.5.5 0 010 1h-1a.5.5 0 01-.5-.5zM4.316 20.316a.5.5 0 01-.707-.707l-.707-.707a.5.5 0 01.707-.707l.707.707zM20.316 4.316a.5.5 0 01-.707.707l-.707-.707a.5.5 0 01.707-.707l.707.707zM12 7a5 5 0 100 10 5 5 0 000-10z" /></svg>;
        }
    };


    // --- Komponen Visual Sawah ---
    const SawahVisual = ({ nama, moisture, isIrrigating }) => {
        const getMoistureConditionClass = (percent) => {
            if (percent <= 25) return "sangat-kering";
            if (percent <= 45) return "kering";
            if (percent <= 65) return "sedikit-basah";
            return "basah";
        };
        const moistureConditionClass = getMoistureConditionClass(moisture);
        const waterLevelHeight = `${moisture}%`; // Tinggi air sesuai kelembaban

        return (
            <div className={`sawah-visual ${moistureConditionClass}`}>
                {nama}
                {isIrrigating && (
                    <>
                        <div className="sawah-water-droplet"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 6h2v6h-2zm0 8h2v2h-2z"/></svg></div>
                        <div className="sawah-water-droplet"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 6h2v6h-2zm0 8h2v2h-2z"/></svg></div>
                        <div className="sawah-water-droplet"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 6h2v6h-2zm0 8h2v2h-2z"/></svg></div>
                    </>
                )}
                <div className="sawah-water-level" style={{ height: waterLevelHeight }}></div>
            </div>
        );
    };


    // --- Halaman Beranda (Dashboard) ---
    const DashboardPage = ({ sawahs, weather, yieldToday, onIrrigateAction, totalMoisteningToday, onNotificationClick, notificationCount, totalMoisteningHistoryData }) => {
        const chartHeight = 100;
        const chartWidth = 100;
        const padding = 10;

        // Points for the total moistening history graph
        // This graph shows the "rate" of watering per simulated minute (0, 1, or 2 active pumps)
        const moisteningPoints = totalMoisteningHistoryData.map((dataPoint, index) => {
            const x = (index / (totalMoisteningHistoryData.length - 1)) * chartWidth;
            // Scale dataPoint.value (0-2) to fit chart height, max 20 for visual representation
            const y = chartHeight - ((dataPoint.value / 20) * (chartHeight - 2 * padding) + padding);
            return `${x},${y}`;
        }).join(' ');

        const getMoistureCondition = (percent) => {
            if (percent <= 25) return { text: "Sangat Kering", class: "sangat-kering" };
            if (percent <= 45) return { text: "Kering", class: "kering" };
            if (percent <= 65) return { text: "Sedikit Basah", class: "sedikit-basah" };
            return { text: "Basah", class: "basah" };
        };

        const sawahA = sawahs.find(s => s.id === 'sawahA');
        const sawahB = sawahs.find(s => s.id === 'sawahB');

        return (
            <>
                <PageHeader title="Irigasi Otomatis" showNotificationIcon={true} notificationCount={notificationCount} onNotificationClick={onNotificationClick} />
                <div className="grid grid-cols-3 gap-6 mb-6">
                    {/* Kartu Sawah A */}
                    <div className="dashboard-card col-span-1">
                        <h3 className="text-xl font-bold text-green-800 mb-2">Sawah A</h3>
                        <SawahVisual nama="Sawah A" moisture={sawahA.moisture} isIrrigating={sawahA.isIrrigating} />
                        <p>Kelembapan Tanah: {sawahA.moisture.toFixed(0)}%</p>
                        <div className={`moisture-indicator ${getMoistureCondition(sawahA.moisture).class}`}>
                            {getMoistureCondition(sawahA.moisture).text}
                        </div>
                        <button
                            onClick={() => onIrrigateAction('sawahA')}
                            className={`mt-4 px-4 py-2 rounded-lg font-semibold text-lg w-full ${sawahA.isManualIrrigating ? 'bg-red-600 hover:bg-red-700' : 'bg-green-800 hover:bg-green-900'} text-white`}
                        >
                            {sawahA.isManualIrrigating ? 'BERHENTI MENYIRAM' : 'SIRAM SEKARANG'}
                        </button>
                           <p className="text-sm text-gray-600 mt-2">Jadwal: {sawahA.autoIrrigationScheduleTime}</p>
                           <p className="text-sm text-gray-600">Otomatis: {sawahA.autoIrrigationEnabled ? 'Aktif' : 'Nonaktif'} (Ambang {sawahA.moistureThreshold}%)</p>
                    </div>

                    {/* Kartu Sawah B */}
                    <div className="dashboard-card col-span-1">
                        <h3 className="text-xl font-bold text-green-800 mb-2">Sawah B</h3>
                        <SawahVisual nama="Sawah B" moisture={sawahB.moisture} isIrrigating={sawahB.isIrrigating} />
                        <p>Kelembapan Tanah: {sawahB.moisture.toFixed(0)}%</p>
                        <div className={`moisture-indicator ${getMoistureCondition(sawahB.moisture).class}`}>
                            {getMoistureCondition(sawahB.moisture).text}
                        </div>
                        <button
                            onClick={() => onIrrigateAction('sawahB')}
                            className={`mt-4 px-4 py-2 rounded-lg font-semibold text-lg w-full ${sawahB.isManualIrrigating ? 'bg-red-600 hover:bg-red-700' : 'bg-green-800 hover:bg-green-900'} text-white`}
                        >
                            {sawahB.isManualIrrigating ? 'BERHENTI MENYIRAM' : 'SIRAM SEKARANG'}
                        </button>
                        <p className="text-sm text-gray-600 mt-2">Jadwal: {sawahB.autoIrrigationScheduleTime}</p>
                        <p className="text-sm text-gray-600">Otomatis: {sawahB.autoIrrigationEnabled ? 'Aktif' : 'Nonaktif'} (Ambang {sawahB.moistureThreshold}%)</p>
                    </div>

                    {/* Kartu Cuaca dan Hasil Hari Ini */}
                    <div className="flex flex-col gap-6 col-span-1">
                        <div className="dashboard-card flex-grow">
                            <p>Cuaca</p>
                            {getWeatherIcon(weather.condition)}
                            <div className="value text-yellow-600 text-3xl">{weather.condition}</div>
                            <div className="text-gray-600 mt-2 text-base">
                                <span>{weather.temp.toFixed(0)}Â°C</span> <span>{weather.humidity.toFixed(0)}%</span>
                            </div>
                        </div>
                        <div className="dashboard-card flex-grow">
                            <p>Hasil Hari Ini</p>
                            <div className="value text-green-800">{yieldToday.toFixed(1)}L</div>
                        </div>
                    </div>
                </div>

                {/* Bagian Total Penyiraman */}
                <div className="grid grid-cols-1 gap-6 mb-6">
                    <div className="dashboard-card p-6 rounded-lg">
                        <p className="text-gray-600">Total Penyiraman</p>
                        <p className="text-xl mb-2">Hari Ini: {totalMoisteningToday.toFixed(0)} menit</p>
                        <div className="chart-container" style={{height: '100px'}}>
                            <svg width="100%" height="100%" viewBox={`0 0 ${chartWidth} ${chartHeight}`} preserveAspectRatio="xMidYMid meet">
                                <polyline
                                    className="chart-line"
                                    points={moisteningPoints}
                                />
                                {totalMoisteningHistoryData.map((dataPoint, index) => {
                                    const x = (index / (totalMoisteningHistoryData.length - 1)) * chartWidth;
                                    const y = chartHeight - ((dataPoint.value / 20) * (chartHeight - 2 * padding) + padding);
                                    return <circle key={index} cx={x} cy={y} r="3" className="chart-dot" />;
                                })}
                                {/* Threshold line at 10 minutes/interval for example, adjusted to chart scale */}
                                <line x1="0" y1={chartHeight - ((10 / 20) * (chartHeight - 2 * padding) + padding)} x2="100%" y2={chartHeight - ((10 / 20) * (chartHeight - 2 * padding) + padding)} stroke="#d4af37" strokeWidth="1" />
                            </svg>
                            <div className="text-xs text-gray-600 mt-1 flex justify-between">
                                {totalMoisteningHistoryData.map((data, idx) => (
                                    <span key={idx} style={{ flexBasis: `${100 / totalMoisteningHistoryData.length}%` }}>{(idx % 5 === 0 || idx === totalMoisteningHistoryData.length -1) ? idx * 1 : ''}</span>
                                ))}
                            </div>
                            <div className="text-xs text-gray-600 text-left mt-1">Menit terakhir</div>
                        </div>
                    </div>
                </div>
            </>
        );
    };

    // --- Halaman Monitoring ---
    const MonitoringPage = ({ sawahs, onSelectSawah, selectedSawahId }) => {
        // Pastikan selectedSawahId valid, jika tidak default ke sawahA
        const selectedSawah = sawahs.find(s => s.id === selectedSawahId) || sawahs.find(s => s.id === 'sawahA');

        const chartHeight = 150;
        const chartWidth = 600;
        const padding = 20;

        const points = selectedSawah.moistureHistory.map((dataPoint, index) => {
            const x = (index / (selectedSawah.moistureHistory.length - 1)) * chartWidth;
            const y = chartHeight - ((dataPoint.value / 100) * (chartHeight - 2 * padding) + padding);
            return `${x},${y}`;
        }).join(' ');

        return (
            <>
                <PageHeader title="Monitoring" />
                <div className="mb-4 flex gap-4">
                    {sawahs.map(sawah => (
                        <button
                            key={sawah.id}
                            className={`px-4 py-2 rounded-lg font-semibold ${selectedSawahId === sawah.id ? 'bg-green-700 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
                            onClick={() => onSelectSawah(sawah.id)}
                        >
                            {sawah.nama}
                        </button>
                    ))}
                </div>

                <div className="bg-gray-100 p-6 rounded-lg mb-6 shadow-sm flex">
                    <div className="flex-grow">
                        <h2 className="text-xl font-semibold text-gray-800 mb-4">Kelembapan Tanah {selectedSawah.nama}</h2>
                        <div className="soil-moisture-chart-container relative" style={{ width: '100%', height: '200px' }}>
                            <svg width="100%" height="100%" viewBox={`-40 0 ${chartWidth + 40} ${chartHeight}`} preserveAspectRatio="xMidYMid meet">
                                <text x="-10" y={chartHeight - ((80 / 100) * (chartHeight - 2 * padding) + padding)} fill="#4b5563" textAnchor="end" dominantBaseline="middle" fontSize="12px">80%</text>
                                <text x="-10" y={chartHeight - ((60 / 100) * (chartHeight - 2 * padding) + padding)} fill="#4b5563" textAnchor="end" dominantBaseline="middle" fontSize="12px">60%</text>
                                <text x="-10" y={chartHeight - ((40 / 100) * (chartHeight - 2 * padding) + padding)} fill="#4b5563" textAnchor="end" dominantBaseline="middle" fontSize="12px">40%</text>
                                <text x="-10" y={chartHeight - ((20 / 100) * (chartHeight - 2 * padding) + padding)} fill="#4b5563" textAnchor="end" dominantBaseline="middle" fontSize="12px">20%</text>

                                {/* Ambang batas disesuaikan dengan ambang sawah yang dipilih */}
                                <line x1="0" y1={chartHeight - ((selectedSawah.moistureThreshold / 100) * (chartHeight - 2 * padding) + padding)} x2={chartWidth} y2={chartHeight - ((selectedSawah.moistureThreshold / 100) * (chartHeight - 2 * padding) + padding)} stroke="#9ca3af" strokeDasharray="4 4" strokeWidth="1" />

                                <polyline className="soil-moisture-chart-line" points={points} />
                                {selectedSawah.moistureHistory.map((dataPoint, index) => {
                                    const x = (index / (selectedSawah.moistureHistory.length - 1)) * chartWidth;
                                    const y = chartHeight - ((dataPoint.value / 100) * (chartHeight - 2 * padding) + padding);
                                    return <circle key={index} cx={x} cy={y} r="4" className="soil-moisture-dot" />;
                                })}
                                <text x={chartWidth * 0.7} y={chartHeight - ((selectedSawah.moistureThreshold / 100) * (chartHeight - 2 * padding) + padding) - 5} textAnchor="end" fill="#4b5563" fontSize="12px">Ambang batas</text>
                            </svg>
                            <div className="flex justify-between text-xs text-gray-600 mt-2 px-4" style={{width: 'calc(100% - 40px)', marginLeft: '40px'}}>
                                {selectedSawah.moistureHistory.map((dataPoint, index) => (
                                    <span key={index} className="text-center" style={{ flexBasis: `${100 / selectedSawah.moistureHistory.length}%` }}>{(index % 5 === 0 || index === selectedSawah.moistureHistory.length -1) ? index : ''}</span>
                                ))}
                            </div>
                            <div className="text-xs text-gray-600 text-left mt-1">Detik terakhir</div>
                        </div>

                        <div className="mt-4 text-center">
                            <h3 className="text-lg font-semibold text-green-800 mb-2">{selectedSawah.nama} Status Pompa:</h3>
                            {/* Pompa selalu berfungsi normal */}
                            <p className={`font-medium text-xl ${selectedSawah.pumpOK ? 'text-green-600' : 'text-red-600'}`}>
                                Pompa Berfungsi Normal
                            </p>
                            <p className="text-gray-700 text-sm">Status Irigasi: {selectedSawah.isIrrigating ? 'Aktif' : 'Nonaktif'}</p>
                        </div>
                    </div>

                    {/* Grafik merah kecil di kanan (asumsi untuk perbandingan umum) */}
                    <div className="bg-white p-4 rounded-lg shadow-md border border-gray-200 ml-4 flex-shrink-0" style={{width: '200px'}}>
                        <div className="chart-container" style={{height: '100px'}}>
                            <h3 className="text-sm font-semibold text-gray-800 mb-2">Suhu Udara (Tren)</h3>
                            <svg width="100%" height="100%">
                                <polyline
                                    fill="none"
                                    stroke="#ef4444"
                                    strokeWidth="2"
                                    points="0,80 25,20 50,60 75,30 100,70"
                                />
                            </svg>
                        </div>
                    </div>
                </div>
            </>
        );
    };

    // --- Halaman Riwayat ---
    const HistoryPage = ({ historyEvents }) => {
        const groupedEvents = historyEvents.reduce((acc, event) => {
            const date = getFormattedDate(event.timestamp);
            if (!acc[date]) {
                acc[date] = [];
            }
            acc[date].push(event);
            return acc;
        }, {});

        return (
            <>
                <PageHeader title="Riwayat" />
                {Object.entries(groupedEvents).length === 0 ? (
                    <div className="p-6 text-center text-gray-500">Tidak ada riwayat.</div>
                ) : (
                    Object.entries(groupedEvents).map(([date, events], index) => (
                        <div key={index} className="mb-8">
                            <h2 className="history-section-date">{date}</h2>
                            {events.map((event, eventIndex) => (
                                <div key={eventIndex} className="history-card">
                                    <div className="icon">
                                        <svg fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 6h2v6h-2zm0 8h2v2h-2z"/>
                                        </svg>
                                    </div>
                                    <div className="details">
                                        <p className="title">{event.sawah}</p>
                                        <p className={`status ${event.active ? 'text-green-600' : 'text-red-600'}`}>{event.action}</p>
                                        <p className="moisture">Kelembapan: {event.moisture}%</p>
                                    </div>
                                    <div className="time">{event.time}</div>
                                </div>
                            ))}
                        </div>
                    ))
                )}
            </>
        );
    };

    // --- Halaman Notifikasi ---
    const NotificationPage = ({ notifications, onMarkAsRead }) => {
        const unreadNotifications = notifications.filter(n => !n.read);
        const readNotifications = notifications.filter(n => n.read);

        return (
            <>
                <PageHeader title="Notifikasi" />
                {notifications.length === 0 ? (
                    <div className="p-6 text-center text-gray-500">Tidak ada notifikasi baru.</div>
                ) : (
                    <>
                        {unreadNotifications.length > 0 && (
                            <h2 className="settings-section-title">Baru ({unreadNotifications.length})</h2>
                        )}
                        {unreadNotifications.map((notif) => (
                            <div key={notif.id} className="notification-card">
                                <div className="icon-circle">
                                    {notif.icon}
                                </div>
                                <div className="content">
                                    <p className="title">{notif.title}</p>
                                    <p className="description">{notif.description}</p>
                                    <button onClick={() => onMarkAsRead(notif.id)} className="read-button">
                                        Tandai Sudah Dibaca
                                    </button>
                                </div>
                                <div className="time">{notif.time}</div>
                            </div>
                        ))}

                        {readNotifications.length > 0 && (
                            <h2 className="settings-section-title">Sudah Dibaca ({readNotifications.length})</h2>
                        )}
                        {readNotifications.map((notif) => (
                            <div key={notif.id} className="notification-card read">
                                <div className="icon-circle">
                                    {notif.icon}
                                </div>
                                <div className="content">
                                    <p className="title">{notif.title}</p>
                                    <p className="description">{notif.description}</p>
                                </div>
                                <div className="time">{notif.time}</div>
                            </div>
                        ))}
                    </>
                )}
            </>
        );
    };

    // --- Halaman Pengaturan ---
    const SettingsPage = ({ sawahs, appSettings, onSettingChange }) => {
        return (
            <>
                <PageHeader title="Pengaturan" />
                {/* Pengaturan Umum */}
                <h2 className="settings-section-title">Umum</h2>
                <div className="settings-item">
                    <span className="label">Bahasa</span>
                    <span className="value">
                        Indonesia
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/>
                        </svg>
                    </span>
                </div>
                <div className="settings-item">
                    <span className="label">Unit Kelembaban</span>
                    <span className="value">
                        %
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/>
                        </svg>
                    </span>
                </div>

                {/* Pengaturan Global */}
                <h2 className="settings-section-title">Pengaturan Global Sistem</h2>
                <div className="settings-item">
                    <span className="label">Notifikasi Aplikasi Aktif</span>
                    <label className="toggle-switch">
                        <input
                            type="checkbox"
                            checked={appSettings.notificationsEnabled}
                            onChange={() => onSettingChange('notificationsEnabled', !appSettings.notificationsEnabled)}
                        />
                        <span className="toggle-slider"></span>
                    </label>
                </div>
                {/* Bagian untuk kemungkinan pompa rusak dihapus karena pompa tidak akan pernah rusak */}

                {/* Pengaturan per Sawah */}
                {sawahs.map(sawah => (
                    <React.Fragment key={sawah.id}>
                        <h2 className="settings-section-title">Pengaturan {sawah.nama}</h2>
                        <div className="settings-item">
                            <span className="label">Penyiraman Otomatis Aktif</span>
                            <label className="toggle-switch">
                                <input
                                    type="checkbox"
                                    checked={sawah.autoIrrigationEnabled}
                                    onChange={() => onSettingChange(`${sawah.id}.autoIrrigationEnabled`, !sawah.autoIrrigationEnabled)}
                                />
                                <span className="toggle-slider"></span>
                            </label>
                        </div>
                        <div className="settings-item">
                            <span className="label">Ambang Kelembaban</span>
                            <input
                                type="number"
                                value={sawah.moistureThreshold}
                                onChange={(e) => onSettingChange(`${sawah.id}.moistureThreshold`, Math.max(0, Math.min(100, parseInt(e.target.value) || 0)))}
                                min="0"
                                max="100"
                            />
                            <span className="value ml-2">%</span>
                        </div>
                        <div className="settings-item">
                            <span className="label">Jadwal Harian Otomatis</span>
                            <select
                                value={sawah.autoIrrigationScheduleTime}
                                onChange={(e) => onSettingChange(`${sawah.id}.autoIrrigationScheduleTime`, e.target.value)}
                            >
                                <option value="00:00">00:00 AM</option>
                                <option value="01:00">01:00 AM</option>
                                <option value="02:00">02:00 AM</option>
                                <option value="03:00">03:00 AM</option>
                                <option value="04:00">04:00 AM</option>
                                <option value="05:00">05:00 AM</option>
                                <option value="06:00">06:00 AM</option>
                                <option value="07:00">07:00 AM</option>
                                <option value="08:00">08:00 AM</option>
                                <option value="09:00">09:00 AM</option>
                                <option value="10:00">10:00 AM</option>
                                <option value="11:00">11:00 AM</option>
                                <option value="12:00">12:00 PM</option>
                                <option value="13:00">01:00 PM</option>
                                <option value="14:00">02:00 PM</option>
                                <option value="15:00">03:00 PM</option>
                                <option value="16:00">04:00 PM</option>
                                <option value="17:00">05:00 PM</option>
                                <option value="18:00">06:00 PM</option>
                                <option value="19:00">07:00 PM</option>
                                <option value="20:00">08:00 PM</option>
                                <option value="21:00">09:00 PM</option>
                                <option value="22:00">10:00 PM</option>
                                <option value="23:00">11:00 PM</option>
                            </select>
                            <span className="value ml-2">WIB</span>
                        </div>
                        <div className="settings-item">
                            <span className="label">Durasi Penyiraman Terjadwal (menit)</span>
                            <input
                                type="number"
                                value={sawah.autoIrrigationDuration}
                                onChange={(e) => onSettingChange(`${sawah.id}.autoIrrigationDuration`, Math.max(1, Math.min(60, parseInt(e.target.value) || 1)))}
                                min="1"
                                max="60"
                            />
                            <span className="value ml-2">menit</span>
                        </div>
                    </React.Fragment>
                ))}
            </>
        );
    };

    // --- Komponen Aplikasi Utama ---
    const App = () => {
        // --- State Utama Aplikasi (Dimuat dari localStorage) ---
        const [activePage, setActivePage] = useState(() => loadState('activePage', 'dashboard'));
        const [weather, setWeather] = useState(() => loadState('weather', { condition: "Cerah", temp: 29, humidity: 52 }));
        
        // Inisialisasi ulang totalMoisteningToday dan history data setiap kali aplikasi dimuat untuk menghindari nilai stuck
        const [totalMoisteningToday, setTotalMoisteningToday] = useState(0); 
        const MAX_CHART_POINTS = 30; // Jumlah titik pada grafik bergerak
        const [totalMoisteningHistoryData, setTotalMoisteningHistoryData] = useState(
            Array.from({ length: MAX_CHART_POINTS }, () => ({ value: 0 }))
        );

        const [yieldToday, setYieldToday] = useState(() => loadState('yieldToday', 0));

        const [historyEvents, setHistoryEvents] = useState(() => {
            const loaded = loadState('historyEvents', []);
            return loaded.map(event => ({ ...event, timestamp: new Date(event.timestamp) })); // Konversi kembali ke Date
        });
        const [notifications, setNotifications] = useState(() => loadState('notifications', []));
        const [notificationCount, setNotificationCount] = useState(() => loadState('notificationCount', 0));

        // onConfirmAction akan menjadi fungsi callback yang akan dipanggil saat user mengklik Ya/Tidak
        const [screenNotification, setScreenNotification] = useState({ message: '', type: '', isVisible: false, onConfirmAction: null }); 

        // State untuk setiap sawah (termasuk history kelembaban per sawah)
        const initialSawahs = [
            {
                id: 'sawahA',
                nama: 'Sawah A',
                moisture: 57,
                isManualIrrigating: false,
                manualIrrigationDuration: 0,
                isAutoIrrigating: false, // Sedang disiram otomatis (ambang atau jadwal)
                pumpOK: true, // Pompa A selalu berfungsi
                autoIrrigationEnabled: true,
                moistureThreshold: 30, // Ambang batas untuk otomatis
                autoIrrigationScheduleTime: '03:00', // Jam terjadwal (misal: 3 pagi)
                autoIrrigationDuration: 10, // Durasi terjadwal
                moistureHistory: Array.from({ length: MAX_CHART_POINTS }, () => ({ value: 50 + (Math.random() - 0.5) * 20 })),
                lastScheduledWateringTimestamp: null, // Untuk melacak penyiraman terjadwal terakhir (timestamp Date.now())
                isIrrigating: false, // True jika manual atau auto sedang aktif
                selected: true, // Default selected for monitoring
                confirmPrompted: false, // Flag untuk notifikasi konfirmasi "sangat basah"
            },
            {
                id: 'sawahB',
                nama: 'Sawah B',
                moisture: 65,
                isManualIrrigating: false,
                manualIrrigationDuration: 0,
                isAutoIrrigating: false,
                pumpOK: true, // Pompa B selalu berfungsi
                autoIrrigationEnabled: true,
                moistureThreshold: 40,
                autoIrrigationScheduleTime: '06:00',
                autoIrrigationDuration: 8,
                moistureHistory: Array.from({ length: MAX_CHART_POINTS }, () => ({ value: 60 + (Math.random() - 0.5) * 15 })),
                lastScheduledWateringTimestamp: null,
                isIrrigating: false,
                selected: false,
                confirmPrompted: false, // Flag untuk notifikasi konfirmasi "sangat basah"
            }
        ];
        // Memuat sawahs, memastikan history memiliki panjang yang benar
        const [sawahs, setSawahs] = useState(() => {
            const loadedSawahs = loadState('sawahs', initialSawahs);
            return loadedSawahs.map(sawah => {
                // Ensure moisture history has correct length
                if (!sawah.moistureHistory || sawah.moistureHistory.length !== MAX_CHART_POINTS) {
                   sawah.moistureHistory = Array.from({ length: MAX_CHART_POINTS }, () => ({ value: sawah.moisture || 50 }));
                }
                // Convert lastScheduledWateringTimestamp back to number if it's not null
                if (sawah.lastScheduledWateringTimestamp !== null && typeof sawah.lastScheduledWateringTimestamp === 'string') {
                    sawah.lastScheduledWateringTimestamp = new Date(sawah.lastScheduledWateringTimestamp).getTime();
                }
                 // Set initial selected state for monitoring if not present
                if (sawah.id === 'sawahA' && !loadedSawahs.some(s => s.selected)) { // Jika sawah A dan belum ada yang selected
                    sawah.selected = true;
                } else if (!sawah.selected) { // Jika bukan sawah A dan tidak selected, biarkan false
                    sawah.selected = false;
                }
                // Pastikan properti baru ada
                if (typeof sawah.confirmPrompted === 'undefined') sawah.confirmPrompted = false; 
                // !!! PENTING: Paksa pumpOK menjadi true saat memuat state lama !!!
                sawah.pumpOK = true; 
                return sawah;
            });
        });


        const initialAppSettings = {
            notificationsEnabled: true,
        };
        const [appSettings, setAppSettings] = useState(() => loadState('appSettings', initialAppSettings));

        // Callback untuk mengubah pengaturan aplikasi (termasuk pengaturan per sawah)
        const onSettingChange = useCallback((path, value) => {
            // Update global settings
            if (!path.includes('.')) {
                setAppSettings(prev => ({ ...prev, [path]: value }));
                return;
            }

            // Update sawah-specific settings
            const [sawahId, settingKey] = path.split('.');
            setSawahs(prevSawahs => prevSawahs.map(sawah => {
                if (sawah.id === sawahId) {
                    return { ...sawah, [settingKey]: value };
                }
                return sawah;
            }));
        }, []);


        // --- Screen Notification logic ---
        const showScreenNotification = useCallback((message, type = 'info', onConfirmAction = null) => {
            setScreenNotification({ message, type, isVisible: true, onConfirmAction });
        }, []);

        const hideScreenNotification = useCallback(() => {
            setScreenNotification(prev => ({ ...prev, isVisible: false, onConfirmAction: null }));
        }, []);

        // --- Logika Simulasi Real-time (menggunakan requestAnimationFrame) ---
        const lastFrameTimeRef = useRef(0);
        const simAccumulatorRef = useRef(0);
        const SIM_INTERVAL_MS = 1000; // Simulasikan 1 menit per 1000ms (1 detik waktu nyata)

        const simulateStep = useCallback(() => {
            const now = Date.now();
            const deltaTime = now - lastFrameTimeRef.current;
            lastFrameTimeRef.current = now;
            simAccumulatorRef.current += deltaTime;

            while (simAccumulatorRef.current >= SIM_INTERVAL_MS) {
                simAccumulatorRef.current -= SIM_INTERVAL_MS;

                // Perbarui cuaca
                setWeather(prev => {
                    const newTemp = Math.max(20, Math.min(40, prev.temp + (Math.random() - 0.5) * 0.5));
                    const newHumidity = Math.max(30, Math.min(90, prev.humidity + (Math.random() - 0.5) * 0.8));
                    let newCondition = prev.condition;
                    if (Math.random() < 0.001) { // Lebih jarang mengubah kondisi cuaca
                        const conditions = ["Cerah", "Berawan", "Hujan"];
                        newCondition = conditions[Math.floor(Math.random() * conditions.length)];
                    }
                    return { temp: newTemp, humidity: newHumidity, condition: newCondition };
                });

                // Perbarui hasil hari ini (peningkatan lambat)
                setYieldToday(prev => prev + (Math.random() * 0.01));

                let currentTotalMoisteningThisInterval = 0; // Untuk grafik dashboard

                setSawahs(prevSawahs => prevSawahs.map(sawah => {
                    let newMoisture = sawah.moisture;
                    let isCurrentlyIrrigating = false; // Status apakah sawah ini sedang menyiram di interval ini

                    const getMoistureConditionString = (moistureVal) => {
                        if (moistureVal <= 25) return "sangat-kering";
                        if (moistureVal <= 45) return "kering";
                        if (moistureVal <= 65) return "sedikit-basah";
                        return "basah";
                    };
                    const moistureCondition = getMoistureConditionString(newMoisture);


                    // 1. Penurunan Kelembapan Alami & Pengaruh Cuaca
                    if (!sawah.isManualIrrigating && !sawah.isAutoIrrigating) {
                        let decayRate = 0.5; // Default decay per menit
                        if (weather.condition.toLowerCase() === 'hujan') {
                            newMoisture = Math.min(100, sawah.moisture + 3); // Kelembaban naik saat hujan
                        } else if (weather.condition.toLowerCase() === 'cerah' && weather.temp > 30) {
                            decayRate = 1.0; // Lebih cepat kering saat panas ekstrem
                        }
                        newMoisture = Math.max(0, newMoisture - decayRate);
                    }

                    // 2. Irigasi Manual
                    if (sawah.isManualIrrigating) {
                        newMoisture = Math.min(100, sawah.moisture + 10); // Bertambah 10% per menit
                        sawah.manualIrrigationDuration -= 1;
                        isCurrentlyIrrigating = true;
                        if (sawah.manualIrrigationDuration <= 0) {
                            sawah.isManualIrrigating = false;
                            sawah.manualIrrigationDuration = 0;
                            showScreenNotification(`Penyiraman manual ${sawah.nama} selesai.`, "info");
                            setHistoryEvents(prev => [
                                {
                                    id: Date.now() + Math.random(), timestamp: new Date(), sawah: sawah.nama,
                                    action: "Penyiraman Dihentikan (Manual - Selesai)", moisture: newMoisture.toFixed(0),
                                    time: getFormattedTime(), active: false,
                                }, ...prev
                            ]);
                        }
                    }

                    // 3. Irigasi Otomatis (Berdasarkan Ambang dan Jadwal)
                    const isSawahBasah = moistureCondition === "basah"; // true jika > 65%
                    const isSawahKeringAtauSangatKering = moistureCondition === "kering" || moistureCondition === "sangat-kering";
                    
                    // Kondisi pemicu otomatis (jika diaktifkan, pompa OK, tidak manual, dan kondisi kering/sangat kering)
                    const shouldAutoIrrigateByThreshold = sawah.autoIrrigationEnabled && sawah.pumpOK && !sawah.isManualIrrigating && isSawahKeringAtauSangatKering;

                    // Logika untuk menghentikan otomatis (jika sedang menyiram otomatis)
                    const shouldStopAutoIrrigation = sawah.isAutoIrrigating && (
                        !sawah.autoIrrigationEnabled || // Otomatis dinonaktifkan
                        isSawahBasah || // Sudah basah
                        sawah.manualIrrigationDuration <= 0 // Durasi otomatis habis (jika pakai manualDuration untuk auto)
                    );

                    // Logika konfirmasi otomatis jika sangat basah (hanya jika sawahA)
                    if (sawah.id === 'sawahA' && sawah.autoIrrigationEnabled && sawah.pumpOK && !sawah.isManualIrrigating && isSawahBasah && newMoisture >= 75 && !sawah.confirmPrompted) {
                        setSawahs(prevSawahs => prevSawahs.map(s => s.id === sawah.id ? { ...s, confirmPrompted: true } : s)); // Set flag agar tidak spam
                        showScreenNotification(
                            `Kondisi ${sawah.nama} sangat basah (${newMoisture.toFixed(0)}%), apakah Anda yakin akan melanjutkan penyiraman otomatis?`,
                            'confirm',
                            (confirm) => {
                                setSawahs(prevSawahs => prevSawahs.map(s => {
                                    if (s.id === sawah.id) {
                                        if (confirm) {
                                            return { ...s, isAutoIrrigating: true, manualIrrigationDuration: s.autoIrrigationDuration, confirmPrompted: false }; // Lanjutkan otomatis
                                        } else {
                                            return { ...s, isAutoIrrigating: false, manualIrrigationDuration: 0, confirmPrompted: true }; // Batalkan, jaga flag
                                        }
                                    }
                                    return s;
                                }));
                                if (!confirm) showScreenNotification(`Penyiraman otomatis ${sawah.nama} dibatalkan.`, "info");
                            }
                        );
                        return { ...sawah, isAutoIrrigating: false }; // Tahan alur simulasi untuk sawah ini sampai ada konfirmasi
                    } else if (isSawahKeringAtauSangatKering && sawah.confirmPrompted) { // Reset confirmPrompted jika sudah kering lagi
                       setSawahs(prevSawahs => prevSawahs.map(s => s.id === sawah.id ? { ...s, confirmPrompted: false } : s));
                    }


                    if (shouldAutoIrrigateByThreshold) { // Jika kondisi kering atau sangat kering, dan pompa ok, dan tidak manual/otomatis
                        if (!sawah.isAutoIrrigating) { // Baru mulai otomatis
                            sawah.isAutoIrrigating = true;
                            sawah.manualIrrigationDuration = sawah.autoIrrigationDuration; // Durasi sesuai pengaturan
                            setHistoryEvents(prev => [
                                {
                                    id: Date.now() + Math.random(), timestamp: new Date(), sawah: sawah.nama,
                                    action: `Penyiraman Otomatis Dimulai (Kelembapan ${newMoisture.toFixed(0)}% - ${moistureCondition})`,
                                    moisture: newMoisture.toFixed(0), time: getFormattedTime(), active: true,
                                }, ...prev
                            ]);
                            if (appSettings.notificationsEnabled) {
                                setNotifications(prev => {
                                    const newNotif = {
                                        id: Date.now() + Math.random(), icon: (<svg className="w-6 h-6 text-green-700" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 6h2v6h-2zm0 8h2v2h-2z"/></svg>),
                                        title: `Penyiraman Otomatis ${sawah.nama} Dimulai`,
                                        description: `Kelembapan tanah ${moistureCondition} (${newMoisture.toFixed(0)}%).`,
                                        time: "Sekarang", read: false,
                                    }; setNotificationCount(c => c + 1); return [newNotif, ...prev];
                                });
                            }
                            showScreenNotification(`Penyiraman otomatis ${sawah.nama} dimulai.`, "info");
                        }
                        newMoisture = Math.min(100, newMoisture + 5);
                        isCurrentlyIrrigating = true;
                    } else if (shouldStopAutoIrrigation) { // Hentikan otomatis jika kondisinya terpenuhi
                        sawah.isAutoIrrigating = false;
                        sawah.manualIrrigationDuration = 0; // Pastikan durasi reset
                        setHistoryEvents(prev => [
                            {
                                id: Date.now() + Math.random(), timestamp: new Date(), sawah: sawah.nama,
                                action: `Penyiraman Otomatis Dihentikan (Kondisi terpenuhi)`,
                                moisture: newMoisture.toFixed(0), time: getFormattedTime(), active: false,
                            }, ...prev
                            ]);
                        showScreenNotification(`Penyiraman otomatis ${sawah.nama} dihentikan.`, "info");
                    }

                    // Lanjutkan penyiraman jika isAutoIrrigating masih true (setelah cek dan pemicu)
                    if (sawah.isAutoIrrigating) {
                        newMoisture = Math.min(100, newMoisture + 5);
                        isCurrentlyIrrigating = true;
                    }


                    // 4. Irigasi Otomatis (Berdasarkan Jadwal Waktu)
                    const currentMinute = new Date().getMinutes();
                    const currentHour = new Date().getHours();
                    const [scheduleHour, scheduleMinute] = sawah.autoIrrigationScheduleTime.split(':').map(Number);

                    const isScheduleTime = currentHour === scheduleHour && currentMinute === scheduleMinute;
                    const lastWateringDate = sawah.lastScheduledWateringTimestamp ? new Date(sawah.lastScheduledWateringTimestamp) : null;
                    const isSameDayAsLastWatering = lastWateringDate && lastWateringDate.getDate() === new Date().getDate() &&
                                                                   lastWateringDate.getMonth() === new Date().getMonth() &&
                                                                   lastWateringDate.getFullYear() === new Date().getFullYear();

                    // Pemicu jadwal hanya jika tidak sedang otomatis atau manual DAN kondisi tidak basah DAN jadwal sudah waktunya DAN belum disiram hari ini
                    if (sawah.autoIrrigationEnabled && sawah.pumpOK && !sawah.isManualIrrigating && !sawah.isAutoIrrigating &&
                        isScheduleTime && !isSameDayAsLastWatering && !isSawahBasah) 
                    {
                           sawah.isAutoIrrigating = true; // Mengaktifkan otomatis berdasarkan jadwal
                           sawah.manualIrrigationDuration = sawah.autoIrrigationDuration; // Durasi sesuai pengaturan
                           sawah.lastScheduledWateringTimestamp = now; // Catat waktu terjadwal

                           setHistoryEvents(prev => [
                               {
                                   id: Date.now() + Math.random(), timestamp: new Date(), sawah: sawah.nama,
                                   action: `Penyiraman Terjadwal Dimulai (${sawah.autoIrrigationScheduleTime} selama ${sawah.autoIrrigationDuration} menit)`,
                                   moisture: newMoisture.toFixed(0), time: getFormattedTime(), active: true,
                               }, ...prev
                           ]);
                           if (appSettings.notificationsEnabled) {
                               setNotifications(prev => {
                                   const newNotif = {
                                       id: Date.now() + Math.random(), icon: (<svg className="w-6 h-6 text-blue-700" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm1-13h-2v6l5.25 3.15.75-1.23-4.5-2.67V7z"/></svg>),
                                       title: `Penyiraman Terjadwal ${sawah.nama} Dimulai`,
                                       description: `Sesuai jadwal pukul ${sawah.autoIrrigationScheduleTime}.`,
                                       time: "Sekarang", read: false,
                                   }; setNotificationCount(c => c + 1); return [newNotif, ...prev];
                               });
                           }
                           showScreenNotification(`Penyiraman terjadwal ${sawah.nama} dimulai.`, "info");
                    }

                    // Perbarui history kelembaban untuk grafik monitoring
                    sawah.moistureHistory = [...sawah.moistureHistory.slice(1), { value: newMoisture }];

                    // Jika sawah ini sedang menyiram, tambahkan ke total penyiraman global
                    if (isCurrentlyIrrigating) {
                        currentTotalMoisteningThisInterval += 1;
                    }

                    // Set status isIrrigating berdasarkan manual/auto
                    sawah.isIrrigating = sawah.isManualIrrigating || sawah.isAutoIrrigating;

                    return { ...sawah, moisture: Math.min(100, Math.max(0, newMoisture)) };
                })); // end of sawah map

                // Perbarui total penyiraman hari ini
                setTotalMoisteningToday(prev => prev + currentTotalMoisteningThisInterval);

                // Perbarui data grafik total penyiraman di dashboard
                setTotalMoisteningHistoryData(prevData => {
                    const newData = [...prevData.slice(1), { value: currentTotalMoisteningThisInterval }];
                    return newData;
                });
            }

            // Minta frame animasi berikutnya
            requestAnimationFrame(simulateStep);
        }, [sawahs, weather.condition, weather.temp, appSettings.notificationsEnabled, historyEvents, notifications, showScreenNotification, screenNotification.onConfirmAction]);


        useEffect(() => {
            // Panggilan awal untuk memulai loop animasi setelah data dimuat
            lastFrameTimeRef.current = Date.now();
            requestAnimationFrame(simulateStep);

            // Tambahkan riwayat awal untuk hari ini jika belum ada
            const today = new Date().toDateString();
            if (historyEvents.length === 0 || (historyEvents[0] && new Date(historyEvents[0].timestamp).toDateString() !== today)) {
                console.log("New day detected or no history. Resetting daily totals and history.");
                setHistoryEvents(prev => [
                    {
                        id: Date.now() + 1, timestamp: new Date(), sawah: "Sistem",
                        action: "Sistem Dimulai", moisture: "N/A", time: getFormattedTime(), active: true,
                    }, ...prev
                ]);
                // Secara eksplisit reset total harian di sini
                setTotalMoisteningToday(0);
                setYieldToday(0);
                setTotalMoisteningHistoryData(Array.from({ length: MAX_CHART_POINTS }, () => ({ value: 0 })));
            }

        }, []); // Hanya berjalan sekali saat mount

        // --- Fungsi Siram Sekarang (Manual) ---
        const handleIrrigateAction = useCallback((sawahId) => {
            setSawahs(prevSawahs => prevSawahs.map(sawah => {
                if (sawah.id === sawahId) {
                    
                    if (sawah.isManualIrrigating) {
                        // Berhenti menyiram
                        showScreenNotification(`Penyiraman manual ${sawah.nama} dihentikan.`, "info");
                        setHistoryEvents(prev => [
                            {
                                id: Date.now() + Math.random(), timestamp: new Date(), sawah: sawah.nama,
                                action: "Penyiraman Dihentikan (Manual)", moisture: sawah.moisture.toFixed(0),
                                time: getFormattedTime(), active: false,
                            }, ...prev
                        ]);
                        return { ...sawah, isManualIrrigating: false, manualIrrigationDuration: 0, isIrrigating: false };
                    } else {
                        // Siram Sekarang
                        
                        if (sawah.moisture >= 75) { // Batasi penyiraman manual jika sudah sangat basah
                            showScreenNotification(`Tanah ${sawah.nama} sudah sangat basah (${sawah.moisture.toFixed(0)}%). Tidak perlu disiram manual.`, "info");
                            return sawah;
                        }
                        if (sawah.isAutoIrrigating) {
                            showScreenNotification(`Penyiraman otomatis ${sawah.nama} sedang berlangsung. Tidak bisa memulai manual.`, "info");
                            return sawah;
                        }

                        // Mulai penyiraman manual
                        showScreenNotification(`Penyiraman manual ${sawah.nama} dimulai selama 5 menit.`, "info");

                        // Tambahkan entri riwayat
                        setHistoryEvents(prev => [
                            {
                                id: Date.now() + Math.random(), timestamp: new Date(), sawah: sawah.nama,
                                action: "Penyiraman Dimulai (Manual)", moisture: sawah.moisture.toFixed(0),
                                time: getFormattedTime(), active: true,
                            }, ...prev
                        ]);
                        if (appSettings.notificationsEnabled) {
                            setNotifications(prev => {
                                const newNotif = {
                                    id: Date.now() + Math.random(), icon: (<svg className="w-6 h-6 text-green-700" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 6h2v6h-2zm0 8h2v2h-2z"/></svg>),
                                    title: `Penyiraman Manual ${sawah.nama} Dimulai`,
                                    description: `Anda memulai penyiraman secara manual pada ${sawah.nama}.`,
                                    time: "Sekarang", read: false,
                                }; setNotificationCount(c => c + 1); return [newNotif, ...prev];
                            });
                        }
                        // Tambahkan 1 menit ke total penyiraman hari ini secara instan saat manual dimulai
                        setTotalMoisteningToday(prev => prev + 1); 
                        return { ...sawah, isManualIrrigating: true, manualIrrigationDuration: 5, isIrrigating: true };
                    }
                }
                return sawah;
            }));
        }, [appSettings.notificationsEnabled, showScreenNotification]);

        // --- Fungsi untuk menandai notifikasi sebagai dibaca ---
        const handleMarkAsRead = useCallback((notificationId) => {
            setNotifications(prevNotifications =>
                prevNotifications.map(notif =>
                    notif.id === notificationId ? { ...notif, read: true } : notif
                )
            );
            setNotificationCount(prevCount => Math.max(0, prevCount - 1));
        }, []);

        // --- Fungsi untuk memilih sawah di halaman monitoring ---
        const handleSelectSawahForMonitoring = useCallback((sawahId) => {
            setSawahs(prevSawahs => prevSawahs.map(sawah => ({
                ...sawah,
                selected: sawah.id === sawahId
            })));
        }, []);


        return (
            <div className="flex h-screen w-full">
            {/* Sidebar */}
            <div className="sidebar">
                <h2 className="text-2xl font-bold mb-6">Menu</h2>
                <ul>
                <li>
                    <button
                        className={activePage === 'dashboard' ? 'active' : ''}
                        onClick={() => setActivePage('dashboard')}
                    >
                    <svg fill="currentColor" viewBox="0 0 24 24">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                    Beranda
                    </button>
                </li>
                <li>
                    <button
                        className={activePage === 'monitoring' ? 'active' : ''}
                        onClick={() => setActivePage('monitoring')}
                    >
                    <svg fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm1-13h-2v6l5.25 3.15.75-1.23-4.5-2.67V7z"/>
                    </svg>
                    Monitoring
                    </button>
                </li>
                <li>
                    <button
                        className={activePage === 'history' ? 'active' : ''}
                        onClick={() => setActivePage('history')}
                    >
                    <svg fill="currentColor" viewBox="0 0 24 24">
                        <path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L8 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>
                    </svg>
                    Riwayat
                    </button>
                </li>
                <li>
                    <button
                        className={activePage === 'notifications' ? 'active' : ''}
                        onClick={() => setActivePage('notifications')}
                    >
                    <svg fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6V9c0-3.07-1.63-5.64-4.5-6.32V2.5c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.18C7.63 3.36 6 5.93 6 9v7l-2 2v1h16v-1l-2-2zm-2 1H8V9c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v8z"/>
                    </svg>
                    Notifikasi
                    </button>
                </li>
                <li>
                    <button
                        className={activePage === 'settings' ? 'active' : ''}
                        onClick={() => setActivePage('settings')}
                    >
                    <svg fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zm-7.43 2.52c-1.85 0-3.35-1.5-3.35-3.35s1.5-3.35 3.35-3.35 3.35 1.5 3.35 3.35-1.5 3.35-3.35 3.35z"/>
                    </svg>
                    Pengaturan
                    </button>
                </li>
                </ul>
            </div>

            {/* Area Konten Utama */}
            <div className="main-content">
                <ScreenNotification
                    message={screenNotification.message}
                    type={screenNotification.type}
                    isVisible={screenNotification.isVisible}
                    onClose={hideScreenNotification}
                    onConfirm={screenNotification.onConfirmAction}
                />
                {activePage === 'dashboard' && (
                    <DashboardPage
                        sawahs={sawahs}
                        weather={weather}
                        yieldToday={yieldToday}
                        onIrrigateAction={handleIrrigateAction}
                        totalMoisteningToday={totalMoisteningToday}
                        onNotificationClick={() => setActivePage('notifications')}
                        notificationCount={notificationCount}
                        totalMoisteningHistoryData={totalMoisteningHistoryData}
                    />
                )}
                {activePage === 'monitoring' && (
                    <MonitoringPage
                        sawahs={sawahs}
                        onSelectSawah={handleSelectSawahForMonitoring}
                        selectedSawahId={sawahs.find(s => s.selected)?.id || 'sawahA'}
                    />
                )}
                {activePage === 'history' && <HistoryPage historyEvents={historyEvents} />}
                {activePage === 'notifications' && <NotificationPage notifications={notifications} onMarkAsRead={handleMarkAsRead} />}
                {activePage === 'settings' && <SettingsPage sawahs={sawahs} appSettings={appSettings} onSettingChange={onSettingChange} />}
            </div>
            </div>
        );
    };

    // Menggunakan createRoot untuk React 18
    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(<App />);
</script>
</body>
</html>
